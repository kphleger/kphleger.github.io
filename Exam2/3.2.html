<html>
	<head>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<style type="text/css">
		table, th, td {
			border: 1px solid black;
			text-align: right;
		}
		th {
			background-color: lightgray;
		}
		</style>
	</head>
	<body>
		<table id="myTable"></table>
		<script type="text/javascript">
			//function declarations
			function drawTable(data, tbodyId, sortKey) {
				//Populate the body of the table
				//	By creating rows...
				var rows = d3.select(tbodyId).selectAll("tr")
					.data(data)
					.enter()
					.append("tr")
					.attr("id", function(d) {return d.ItemNo;})
					//begin interactivity definitions
					//change to the appropriate color on mouseover
					.on("mouseover", function(d) {
						if (selected === d3.select(this).attr("id")) {
							d3.select(this).style("background-color", "darkgreen");
						} else {
							d3.select(this).style("background-color", "yellow");
						}
					})
					//change it back on mouseout
					.on("mouseout", function(d) {
						if (selected === d3.select(this).attr("id")) {
							d3.select(this).style("background-color", "green");
						} else {
							d3.select(this).style("background-color", "white");
						}
					})
					//change to the appropriate color on mouseover - darkgreen because you're hovering over it when you click!
					.on("click", function(d) {
						selected = d3.select(this).attr("id");
						d3.selectAll("tr").style("background-color", "white");
						d3.select(this).style("background-color", "darkgreen");
					});
				//	...then populating the rows with cells
				var cells = rows.selectAll("td")
					.data(function(d) {return d3.values(d);})
					.enter()
					.append("td")
					.text(function(d) {return d;});
			}
			
			function sortData(dataSet, key) {
				var isSorted = false;
				var obj;
				while(!isSorted) {
					isSorted = true;
					for(var i = 0, len = dataSet.length; i < (len-1); i++) {
						if(dataSet[i][key] < dataSet[i+1][key]) {
							isSorted = false;
							obj = dataSet[i];
							dataSet[i] = dataSet[i+1];
							dataSet[i+1] = obj;
						}
					}
				}
				return dataSet;
			}
			
			//declare global variables
			var jsonLink = "http://kphleger.github.io/Exam2/exam2.json";
//			var jsonLink = "exam2.json";
			var selected = "";

			//Get the data and make the table!
			d3.json(jsonLink, function(data) {
				//Create the head of the table
				var thead = d3.select("#myTable").append("thead");
				//Populate the head of the table
				var headCells = thead.selectAll("th")
					.data(d3.keys(data[0]))
					.enter()
					.append("th")
					.text(function(d) {return d;})
					.on("click", function(d) {
						d3.select("#tbody").remove();
						tbody = d3.select("#myTable").append("tbody").attr("id", "tbody");
						data = sortData(data, d);
						drawTable(data, "#tbody", d);
						d3.selectAll("th").style("background-color", "lightgray");
						d3.select(this).style("background-color", "gold");
					});
				
				//Create the body of the table
				var tbody = d3.select("#myTable").append("tbody")
					.attr("id", "tbody");
				drawTable(data, "#tbody");
			});
		</script>
	</body>
</html>